app: blackledger
ts: 20231110035557748
name: account
depends:
- blackledger:20230718035300931_ulid
- blackledger:20231110035214790_currency
doc: >-
  account: Chart of all accounts. Fields:

  * id = unique primary key account identifier
  * name = the name of the account, unique within the parent relationship
  * num = the (optional) account number, unique if provided
  * normal = the "normal side" (debit = 'DR' or credit = 'CR') for account display
  * curr = the operating currency (code) for this account
  * version = the account version, which equals the latest transaction entry id, for
    optimistic locking / concurrency control. Null means no transaction entries yet.

up:
- |-
  CREATE SEQUENCE account_id_seq AS smallint CYCLE;
  CREATE TABLE account (
    id          uuid      PRIMARY KEY DEFAULT gen_id('account_id_seq')

    , name      varchar   NOT NULL UNIQUE               -- name of the account
    , parent_id uuid      REFERENCES account(id)        -- optional parent account
    , UNIQUE NULLS NOT DISTINCT (parent_id, name)       -- unique name per parent (null
                                                        --   parents are all the same)
    , num       integer   UNIQUE                        -- optional unique account num

    , normal    varchar(2)
                  NOT NULL
                  CHECK (normal in ('DR', 'CR'))
    , version   uuid                                    -- account version (=last entry)
  );
  INSERT INTO account (name, normal)
  VALUES
    ('Asset', 'DR'),
    ('Expense', 'DR'),
    ('Income', 'CR'),
    ('Liability', 'CR'),
    ('Equity', 'CR');
dn:
- |-
  DROP TABLE account;
  DROP SEQUENCE account_id_seq;
